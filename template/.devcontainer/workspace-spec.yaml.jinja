name: {{ env }}
version: 1.0.0
metadata:
  org: {{ org }}
  project: {{ project }}
  environment: {{ env }}
  description: Workspace for {{ org }}/{{ project }}
  tags:
    - {{ project_type }}
devcontainer:
  image:
    name: {{ image }}
  user: vscode
  workspace_folder: /workspace
  workspace_mount: source=${localWorkspaceFolder},target=/workspace,type=bind
  run_args:
    - --cap-add=SYS_PTRACE
    - --security-opt=seccomp=unconfined
  mounts:
    - source: {{ env }}-home
      target: /home/vscode
      type: volume
    - source: {{ env }}-cache
      target: /home/vscode/.cache
      type: volume
  lifecycle:
    post_create:
      - ./.devcontainer/scripts/post-create.sh
    post_start:
      - ./.devcontainer/scripts/post-start.sh
  customizations:
    extensions:
      recommended:
        - ms-azuretools.vscode-docker
        - ms-vscode.remote-explorer
        {%- if project_type == "Python" %}
        - ms-python.python
        {%- elif project_type == "Node.js" %}
        - dbaeumer.vscode-eslint
        - esbenp.prettier-vscode
        {%- elif project_type == "Rust" %}
        - rust-lang.rust-analyzer
        - tamasfe.even-better-toml
        {%- elif project_type == "Monorepo (polyglot)" %}
        - ms-python.python
        - dbaeumer.vscode-eslint
        - rust-lang.rust-analyzer
        - tamasfe.even-better-toml
        {%- endif %}
    settings:
      values:
        terminal.integrated.defaultProfile.linux: zsh
        terminal.integrated.cwd: /workspace
        files.trimTrailingWhitespace: true
        editor.formatOnSave: true
persistence:
  enabled: {{ persistence_enabled | lower }}
  mode: replicated
  {%- if persistence_enabled %}
  # Configure named remotes and sync paths for your storage backend
  # default_remote: primary
  # remotes:
  #   primary:
  #     type: s3
  #     bucket: my-bucket
  #     options:
  #       provider: Cloudflare  # or AWS, etc.
  #       access_key_id: ${S3_ACCESS_KEY_ID}
  #       secret_access_key: ${S3_SECRET_ACCESS_KEY}
  #       endpoint: ${S3_ENDPOINT}
  #       region: auto
  # sync:
  #   - name: workspace
  #     path: /workspace
  #     remote_path: workspaces/{{ org }}/{{ project }}/{{ env }}/workspace
  #     direction: bidirectional
  #     interval: 300
  {%- endif %}
networking:
  enabled: false
  # Set enabled: true and provide TAILSCALE_AUTH_KEY to join a tailnet
  # hostname_prefix: dev-
  # tags:
  #   - tag:devcontainer
generated_at: "{{ '%Y-%m-%dT%H:%M:%SZ' | strftime }}"
